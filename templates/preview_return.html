{% extends 'base.html' %}

{% block header %}
  <h1>{% block title %}VAT Return tool{% endblock %}</h1>
{% endblock %}

{% block content %}
  {% if request.args.confirmation_error %}
  <div class="alert alert-danger">
    You can only submit a return when you have made the declaration that the information is true and complete
  </div>
  {% endif %}

  {% if g.data %}
  <h1>Review and confirm your VAT return</h1>
  <p>Please check the following carefully. If you're happy with it, then click submit.</p>
  <table class="table striped">
    <tr>
      <th>VAT due on sales (box 1)</th>
      <td>{{ g.data.vatDueSales }}</td>
    </tr>
    <tr>
      <th>VAT due on acquisitions (box 2)</th>
      <td>{{ g.data.vatDueAcquisitions }}</td>
    </tr>
    <tr>
      <th>Total VAT due (box 3)</th>
      <td>{{ g.data.totalVatDue }}</td>
    </tr>
    <tr>
      <th>VAT reclaimed current period (box 4)</th>
      <td>{{ g.data.vatReclaimedCurrPeriod }}</td>
    </tr>
    <tr>
      <th>Net VAT due (box 5)</th>
      <td>{{ g.data.netVatDue }}</td>
    </tr>
    <tr>
      <th>Total value of sales ex VAT (box 6)</th>
      <td>{{ g.data.totalValueSalesExVAT }}</td>
    </tr>
    <tr>
      <th>Total value of purchases ex VAT (box 7)</th>
      <td>{{ g.data.totalValuePurchasesExVAT }}</td>
    </tr>
    <tr>
      <th>Total value of goods supplied ex VAT (box 8)</th>
      <td>{{ g.data.totalValueGoodsSuppliedExVAT }}</td>
    </tr>
    <tr>
      <th>Total acquisitions ex VAT (box 9)</th>
      <td>{{ g.data.totalAcquisitionsExVAT }}</td>
    </tr>
    <tr>
      <th>Finalised?</th>
      <td>{{ g.data.finalised }}</td>
    </tr>
  </table>


  <div class="alert alert-warning">
    When you submit this VAT information you are making a legal declaration that the information is true and complete. A false declaration can result in prosecution.
  </div>
  <form action="{{ url_for('send_return', period_key=g.data.periodKey) }}" method="post">
    <div class="form-check">
      <input class="form-check-input" type="checkbox" name="complete" value="complete" id="confirmation">
      <label class="form-check-label" for="confirmation">
        I confirm this information is true and complete
      </label>
    </div>
    <input type="hidden" name="vat_csv" value="{{ g.vat_csv }}">
    <input type="hidden" name="period_end" value="{{ g.period_end }}">
    <input type="submit" value="Submit this return to HMRC" class="btn btn-info">
  </form>
  {% else %}

  <h1>Provide your VAT data for period {{ g.period_end }} </h1>
<p>This should be a link to a CSV with the headers <code>VAT period</code>, <code>VAT Due Sales	VAT Due Acquisitions</code>,<code>VAT Reclaimed Curr Period</code>,	<code>Total Value Sales Ex VAT</code>, <code>Total Value Purchases Ex VAT</code>, <code>Total Value Goods Supplied Ex VAT</code>, <code>Total Acquisitions Ex VAT</code> (named like exactly like that) </p>
<p>This can have as many rows as you like, but exactly one row must match the VAT period you're currently submitting for (viz. <code>{{ g.period_end }}</code>).  When you click the submit button, this software will simply sum any such matching rows and fill out your return accordingly.</p>

<p>When you press submit, you a return will be generated for you, <em>but not submitted</em>; you'll get a chance to review it before submitting.</p>

  {% if error %}
        <div class="alert alert-danger">
           <p><strong>Error:</strong> {{ error|safe }}
        </div>
  {% endif %}
           
  <form action="{{ url_for('preview_return', period_key=g.period_key, period_end=g.period_end) }}" method="get">
  <div class="form-group">
    <label for="url">Link to CSV (e.g. published from Google Sheets)</label>
    <input type="hidden" name="period_end" value="{{ g.period_end }}">
    <input name="vat_csv" type="url" class="form-control" id="url" aria-describedby="urlHelp" placeholder="https://docs.google.com/....">
    <small id="urlHelp" class="form-text text-muted">This is never stored anywhere on our system</small>
  </div>
  <button type="submit" class="btn btn-primary">Submit</button>
  </form>
  <hr>
  <div class="alert alert-secondary">
    <h3>Example spreadsheet</h3>
    <img src="/img/spreadsheet.png" width="100%" height="100%">
</div>
{% endif %}
{% endblock %}
